<div class="announcements-management">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1>Announcement Management</h1>
      <p>Manage announcements and their content</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="onAddAnnouncement()" [disabled]="loading">
        <i class="fas fa-plus"></i>
        Add Announcement
      </button>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="search-section">
    <div class="search-bar">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="Search announcements..."
        class="search-input"
        (keyup.enter)="onSearch()"
      />
      <button class="btn btn-secondary" (click)="onSearch()" [disabled]="loading">
        <i class="fas fa-search"></i>
        Search
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="error">
    <div class="alert alert-error">
      <i class="fas fa-exclamation-triangle"></i>
      {{ error }}
      <button class="close-btn" (click)="error = null">&times;</button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading && announcements.length === 0">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading announcements...</p>
    </div>
  </div>

  <!-- Announcements Table -->
  <div class="table-container" *ngIf="!loading || announcements.length > 0">
    <table class="announcements-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Author</th>
          <th>Published</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let announcement of announcements" class="announcement-row">
          <td class="announcement-title">
            <div class="title-content">
              <strong>{{ announcement.title }}</strong>
              <div class="title-summary" *ngIf="announcement.summary">
                {{ announcement.summary | slice:0:100 }}{{ announcement.summary.length > 100 ? '...' : '' }}
              </div>
            </div>
          </td>
          <td class="announcement-category">
            <span *ngIf="announcement.category; else noCategory">
              {{ announcement.category }}
            </span>
            <ng-template #noCategory>
              <span class="text-muted">No category</span>
            </ng-template>
          </td>
          <td class="announcement-priority">
            <span [class]="getPriorityClass(announcement.priority)">
              {{ getPriorityDisplayName(announcement.priority) }}
            </span>
          </td>
          <td class="announcement-status">
            <span [class]="getStatusClass(announcement.isPublished)">
              {{ getStatusDisplayName(announcement.isPublished) }}
            </span>
          </td>
          <td class="announcement-author">
            <span *ngIf="announcement.author; else noAuthor">
              {{ announcement.author }}
            </span>
            <ng-template #noAuthor>
              <span class="text-muted">No author</span>
            </ng-template>
          </td>
          <td class="announcement-published">
            <span *ngIf="announcement.publishedAt; else notPublished">
              {{ announcement.publishedAt | date:'short' }}
            </span>
            <ng-template #notPublished>
              <span class="text-muted">Not published</span>
            </ng-template>
          </td>
          <td class="announcement-actions">
            <button 
              class="btn btn-sm btn-outline-primary" 
              (click)="onEditAnnouncement(announcement)"
              [disabled]="loading"
              title="Edit announcement"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button 
              class="btn btn-sm btn-outline-danger" 
              (click)="onDeleteAnnouncement(announcement)"
              [disabled]="loading"
              title="Delete announcement"
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="announcements.length === 0 && !loading">
      <div class="empty-content">
        <i class="fas fa-bullhorn"></i>
        <h3>No Announcements Found</h3>
        <p>Start by adding your first announcement.</p>
        <button class="btn btn-primary" (click)="onAddAnnouncement()">
          <i class="fas fa-plus"></i>
          Add Announcement
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination-info">
      Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ Math.min(currentPage * pageSize, totalAnnouncements) }} of {{ totalAnnouncements }} announcements
    </div>
    <div class="pagination">
      <button 
        class="btn btn-sm btn-outline-secondary" 
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1 || loading"
      >
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of pages" 
          class="btn btn-sm"
          [class.btn-primary]="page === currentPage"
          [class.btn-outline-secondary]="page !== currentPage"
          (click)="onPageChange(page)"
          [disabled]="loading"
        >
          {{ page }}
        </button>
      </div>
      
      <button 
        class="btn btn-sm btn-outline-secondary" 
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages || loading"
      >
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Announcement Form Modal -->
<div class="modal-overlay" *ngIf="showAnnouncementForm" (click)="onCancelForm()">
  <div class="modal-content large-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingAnnouncement ? 'Edit Announcement' : 'Add New Announcement' }}</h2>
      <button class="close-btn" (click)="onCancelForm()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form [formGroup]="announcementForm" (ngSubmit)="onSaveAnnouncement()">
        <div class="form-row">
          <div class="form-group">
            <label for="title">Title *</label>
            <input
              type="text"
              id="title"
              name="title"
              formControlName="title"
              required
              minlength="5"
              maxlength="255"
              class="form-control"
              [class.error]="announcementForm.invalid && announcementForm.touched"
              placeholder="Enter announcement title"
            />
            <div class="error-message" *ngIf="announcementForm.invalid && announcementForm.touched">
              Title is required and must be at least 5 characters long.
            </div>
          </div>

          <div class="form-group">
            <label for="category">Category</label>
            <select
              id="category"
              name="category"
              formControlName="category"
              class="form-control"
            >
              <option value="">Select category</option>
              <option *ngFor="let category of availableCategories" [value]="category">
                {{ category }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="author">Author</label>
            <input
              type="text"
              id="author"
              name="author"
              formControlName="author"
              maxlength="255"
              class="form-control"
              placeholder="Enter author name"
            />
          </div>

          <div class="form-group">
            <label for="priority">Priority</label>
            <select
              id="priority"
              name="priority"
              formControlName="priority"
              class="form-control"
            >
              <option *ngFor="let priority of availablePriorities" [value]="priority">
                {{ getPriorityDisplayName(priority) }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="summary">Summary</label>
          <textarea
            id="summary"
            name="summary"
            formControlName="summary"
            maxlength="500"
            class="form-control"
            rows="3"
            placeholder="Enter announcement summary"
          ></textarea>
          <div class="form-help">
            {{ (announcementForm.get('summary')?.value || '').length }}/500 characters
          </div>
        </div>

        <div class="form-group">
          <label for="content">Content *</label>
          <div class="quill-editor-container">
            <div #quillEditor class="quill-editor"></div>
          </div>
          <div class="form-help">
            Use the rich text editor to format your content.
          </div>
        </div>

        <div class="form-group">
          <label for="tags">Tags</label>
          <div class="tags-input-container">
            <div class="tags-display">
              <span *ngFor="let tag of announcementForm.get('tags')?.value" class="tag">
                {{ tag }}
                <button type="button" class="tag-remove" (click)="removeTag(tag)">&times;</button>
              </span>
            </div>
            <input
              type="text"
              #tagInput
              class="form-control"
              placeholder="Add a tag and press Enter"
              (keyup.enter)="addTag(tagInput)"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input
              type="url"
              id="imageUrl"
              name="imageUrl"
              formControlName="imageUrl"
              class="form-control"
              placeholder="https://example.com/image.jpg"
            />
          </div>

          <div class="form-group">
            <label for="readTime">Read Time (minutes)</label>
            <input
              type="number"
              id="readTime"
              name="readTime"
              formControlName="readTime"
              min="1"
              max="120"
              class="form-control"
              placeholder="5"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="file">Upload Image/Attachment</label>
          <div class="file-upload-container">
            <input
              type="file"
              id="file"
              name="file"
              (change)="onFileSelected($event)"
              accept="image/*,.pdf,.doc,.docx,.txt"
              class="file-input"
            />
            <label for="file" class="file-upload-label">
              <i class="fas fa-upload"></i>
              Choose File
            </label>
            <div class="file-preview" *ngIf="filePreview">
              <img [src]="filePreview" alt="Preview" class="file-preview-image" />
              <button type="button" class="file-remove" (click)="removeFile()">&times;</button>
            </div>
          </div>
          <div class="form-help">
            Supported formats: Images, PDF, DOC, DOCX, TXT (max 10MB)
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              name="isPublished"
              formControlName="isPublished"
            />
            <span class="checkmark"></span>
            Publish immediately
          </label>
          <div class="form-help">
            Uncheck to save as draft.
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="onCancelForm()"
        [disabled]="loading"
      >
        Cancel
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="onSaveAnnouncement()"
        [disabled]="announcementForm.invalid || loading"
      >
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        {{ editingAnnouncement ? 'Update' : 'Create' }} Announcement
      </button>
    </div>
  </div>
</div>