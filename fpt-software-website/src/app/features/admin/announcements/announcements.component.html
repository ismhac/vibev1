<div class="announcements-page">
  <div class="page-header">
    <h1>Announcement Management</h1>
    <p>Manage announcements and their content</p>
  </div>

  <div class="page-content">
    <!-- Search and Actions -->
    <div class="toolbar">
      <div class="search-section">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Search announcements..."
          class="search-input"
          (keyup.enter)="onSearch()"
        />
        <button class="search-btn" (click)="onSearch()">Search</button>
      </div>
      <button class="add-btn" (click)="onAddAnnouncement()">Add Announcement</button>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- Announcements Table -->
    <div *ngIf="!loading" class="announcements-table-container">
      <table class="announcements-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Author</th>
            <th>Published</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let announcement of announcements" class="announcement-row">
            <td>
              <strong>{{ announcement.title }}</strong>
              <div *ngIf="announcement.summary" class="title-summary">
                {{ announcement.summary | slice:0:100 }}{{ announcement.summary.length > 100 ? '...' : '' }}
              </div>
            </td>
            <td>{{ announcement.category || 'No category' }}</td>
            <td>
              <span class="priority-badge" [class]="getPriorityClass(announcement.priority)">
                {{ getPriorityDisplayName(announcement.priority) }}
              </span>
            </td>
            <td>
              <span class="status-badge" [class]="getStatusClass(announcement.isPublished)">
                {{ getStatusDisplayName(announcement.isPublished) }}
              </span>
            </td>
            <td>{{ announcement.author || 'No author' }}</td>
            <td>{{ announcement.publishedAt ? (announcement.publishedAt | date:'short') : 'Not published' }}</td>
            <td class="actions">
              <button class="edit-btn" (click)="onEditAnnouncement(announcement)">Edit</button>
              <button class="delete-btn" (click)="onDeleteAnnouncement(announcement)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="announcements.length === 0" class="empty-state">
        <p>No announcements found</p>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="!loading && totalPages > 1" class="pagination">
      <button 
        class="page-btn" 
        [disabled]="currentPage === 1"
        (click)="onPageChange(currentPage - 1)"
      >
        Previous
      </button>
      
      <button 
        *ngFor="let page of pages" 
        class="page-btn"
        [class.active]="page === currentPage"
        (click)="onPageChange(page)"
      >
        {{ page }}
      </button>
      
      <button 
        class="page-btn" 
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(currentPage + 1)"
      >
        Next
      </button>
    </div>
  </div>
</div>

<!-- Announcement Form Modal -->
<div class="modal-overlay" *ngIf="showAnnouncementForm" (click)="onCancelForm()">
  <div class="modal-content large-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingAnnouncement ? 'Edit Announcement' : 'Add New Announcement' }}</h2>
      <button class="close-btn" (click)="onCancelForm()">&times;</button>
    </div>
    
    <div class="modal-scrollable">
      <div class="modal-body">
        <form [formGroup]="announcementForm" (ngSubmit)="onSaveAnnouncement()">
        <div class="form-row">
          <div class="form-group">
            <label for="title">Title *</label>
            <input
              type="text"
              id="title"
              name="title"
              formControlName="title"
              required
              minlength="5"
              maxlength="255"
              class="form-control"
              [class.error]="announcementForm.invalid && announcementForm.touched"
              placeholder="Enter announcement title"
            />
            <div class="error-message" *ngIf="announcementForm.invalid && announcementForm.touched">
              Title is required and must be at least 5 characters long.
            </div>
          </div>

          <div class="form-group">
            <label for="category">Category</label>
            <select
              id="category"
              name="category"
              formControlName="category"
              class="form-control"
            >
              <option value="">Select category</option>
              <option *ngFor="let category of availableCategories" [value]="category">
                {{ category }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="author">Author</label>
            <input
              type="text"
              id="author"
              name="author"
              formControlName="author"
              maxlength="255"
              class="form-control"
              placeholder="Enter author name"
            />
          </div>

          <div class="form-group">
            <label for="priority">Priority</label>
            <select
              id="priority"
              name="priority"
              formControlName="priority"
              class="form-control"
            >
              <option *ngFor="let priority of availablePriorities" [value]="priority">
                {{ getPriorityDisplayName(priority) }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="summary">Summary</label>
          <textarea
            id="summary"
            name="summary"
            formControlName="summary"
            maxlength="500"
            class="form-control"
            rows="3"
            placeholder="Enter announcement summary"
          ></textarea>
          <div class="form-help">
            {{ (announcementForm.get('summary')?.value || '').length }}/500 characters
          </div>
        </div>

        <div class="form-group">
          <label for="content">Content *</label>
          <textarea
            id="content"
            name="content"
            formControlName="content"
            class="form-control"
            rows="8"
            placeholder="Enter announcement content"
            required
          ></textarea>
          <div class="form-help">
            Enter the main content of the announcement.
          </div>
        </div>

        <div class="form-group">
          <label for="tags">Tags</label>
          <div class="tags-input-container">
            <div class="tags-display">
              <span *ngFor="let tag of announcementForm.get('tags')?.value" class="tag">
                {{ tag }}
                <button type="button" class="tag-remove" (click)="removeTag(tag)">&times;</button>
              </span>
            </div>
            <input
              type="text"
              #tagInput
              class="form-control"
              placeholder="Add a tag and press Enter"
              (keyup.enter)="addTag(tagInput)"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input
              type="url"
              id="imageUrl"
              name="imageUrl"
              formControlName="imageUrl"
              class="form-control"
              placeholder="https://example.com/image.jpg"
            />
          </div>

          <div class="form-group">
            <label for="readTime">Read Time (minutes)</label>
            <input
              type="number"
              id="readTime"
              name="readTime"
              formControlName="readTime"
              min="1"
              max="120"
              class="form-control"
              placeholder="5"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="file">Upload Image/Attachment</label>
          <div class="file-upload-container">
            <input
              type="file"
              id="file"
              name="file"
              (change)="onFileSelected($event)"
              accept="image/*,.pdf,.doc,.docx,.txt"
              class="file-input"
            />
            <label for="file" class="file-upload-label">
              <i class="fas fa-upload"></i>
              Choose File
            </label>
            <div class="file-preview" *ngIf="filePreview">
              <img [src]="filePreview" alt="Preview" class="file-preview-image" />
              <button type="button" class="file-remove" (click)="removeFile()">&times;</button>
            </div>
          </div>
          <div class="form-help">
            Supported formats: Images, PDF, DOC, DOCX, TXT (max 10MB)
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              name="isPublished"
              formControlName="isPublished"
            />
            <span class="checkmark"></span>
            Publish immediately
          </label>
          <div class="form-help">
            Uncheck to save as draft.
          </div>
        </div>
        </form>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="onCancelForm()"
        [disabled]="loading"
      >
        Cancel
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="onSaveAnnouncement()"
        [disabled]="announcementForm.invalid || loading"
      >
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        {{ editingAnnouncement ? 'Update' : 'Create' }} Announcement
      </button>
    </div>
  </div>
</div>